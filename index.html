<!DOCTYPE html>
<html lang="ja" dir="ltr">
  <head>
    <meta charset="utf-8">
    <title>階層ToDoリスト</title>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
  </head>
  <body>
    <p>階層ToDoリストのページです。</p>
    <input type="text" id="inputToDo" required minlength="1" maxlength="15" size="20">
    <button id="inputButton">追加</button>
    <p>--- ToDoリスト ---</p>
    <ul id="todoList"></ul>
  </body>
  <script>
    let todoElement = "";
    $.ajax({
      type: "GET",
      url: "sample.json", // ファイルパス（相対パス）
      dataType: "json", // ファイル形式
      async: false // 非同期通信フラグ
    }).then(
      function (json) {
        let reflexive = (list) => {
          list.forEach((element) => {
            todoElement = todoElement + "<li>" + element["title"] + "</li>"
            if ("subList" in element) {
              todoElement = todoElement + "<ul>"
              reflexive(element["subList"]);
              todoElement = todoElement + "</ul>"
            }
          });
        };
        var todoList = json["list"]
        reflexive(todoList);
        $('#todoList').append(todoElement);
      },
      function () {
        console.log("読み込みに失敗しました");
      }
    );
    $('#inputButton').on('click', function() {
      var target = '<li>' + $('#inputToDo').val() + '</li>';
      $('ul').append(target);
      $('#inputToDo').val('');
    });
  </script>
</html>
